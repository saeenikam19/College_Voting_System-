{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="card-title mb-0">
          <i class="fas fa-history me-2"></i>Audit Log
        </h4>
        <small class="text-white-50">System activity and voting records</small>
      </div>
      <div class="card-body">
        {% if audits %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th scope="col" class="text-center">#</th>
                  <th scope="col">Action</th>
                  <th scope="col">User</th>
                  <th scope="col">Details</th>
                  <th scope="col">Timestamp</th>
                  <th scope="col" class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for a in audits %}
                <tr>
                  <td class="text-center text-muted small">{{ a[0] }}</td>
                  <td>
                    {% if 'vote' in a[1] %}
                      <span class="badge bg-success"><i class="fas fa-vote-yea me-1"></i>{{ a[1] }}</span>
                    {% elif 'promote' in a[1] %}
                      <span class="badge bg-info"><i class="fas fa-user-plus me-1"></i>{{ a[1] }}</span>
                    {% elif 'demote' in a[1] %}
                      <span class="badge bg-warning"><i class="fas fa-user-minus me-1"></i>{{ a[1] }}</span>
                    {% elif 'add_candidate' in a[1] %}
                      <span class="badge bg-primary"><i class="fas fa-plus-circle me-1"></i>{{ a[1] }}</span>
                    {% elif 'delete_candidate' in a[1] %}
                      <span class="badge bg-danger"><i class="fas fa-trash me-1"></i>{{ a[1] }}</span>
                    {% elif 'reset' in a[1] %}
                      <span class="badge bg-secondary"><i class="fas fa-undo me-1"></i>{{ a[1] }}</span>
                    {% elif 'feedback' in a[1] %}
                      <span class="badge bg-info"><i class="fas fa-comments me-1"></i>{{ a[1] }}</span>
                    {% else %}
                      <span class="badge bg-light text-dark">{{ a[1] }}</span>
                    {% endif %}
                  </td>
                  <td>
                    <strong>{{ a[2] }}</strong>
                  </td>
                  <td class="text-muted">
                    {% if a[3] %}
                      {{ a[3] }}
                    {% else %}
                      <em class="text-muted">No details</em>
                    {% endif %}
                  </td>
                  <td class="small">
                    {% if a[4] %}
                      <time datetime="{{ a[4] }}" title="{{ a[4] }}">
                        {{ a[4].split('T')[0] }} {{ a[4].split('T')[1].split('.')[0] }}
                      </time>
                    {% else %}
                      <em class="text-muted">Unknown</em>
                    {% endif %}
                  </td>
                  <td class="text-center">
                    {% if a[1] in ['promote_user','demote_user','add_candidate','delete_candidate'] %}
                      <form method="post" action="{{ url_for('undo_audit', audit_id=a[0]) }}" class="d-inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('Are you sure you want to undo this action?')"
                                title="Undo this action">
                          <i class="fas fa-undo"></i> Undo
                        </button>
                      </form>
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="mt-3 text-muted small">
            <i class="fas fa-info-circle me-1"></i>
            Showing last 500 entries. Only certain actions can be undone.
          </div>
        {% else %}
          <div class="text-center py-5">
            <i class="fas fa-history fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No Audit Records</h5>
            <p class="text-muted">System activity will appear here as users interact with the voting system.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}